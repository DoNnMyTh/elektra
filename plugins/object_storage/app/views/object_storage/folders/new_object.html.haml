= content_for :title do
  - if @object.clean_path.empty?
    Upload file
  - else
    Upload file to: #{@object.clean_path}

= simple_form_for @new_object, url: plugin('object_storage').create_object_path(@container_name, @object.path), method: :post, remote: request.xhr?, authenticity_token: true, html: { data: { modal: true } } do |f|
  %div{class: modal? ? 'modal-body' : ''}

    %p.alert.alert-warning
      -# this limit is enforced by nginx, see http://nginx.org/en/docs/http/ngx_http_core_module.html#client_max_body_size
      This dialog only accepts files
      %strong smaller than 1 MiB.
      - if services.available?(:identity, :web_console)
        To upload larger files, please use a different client, such as the
        = succeed '.' do
          = link_to 'web console', plugin('identity').projects_web_console_path, target: '_blank', id: 'linkto_webconsole'
      - else
        To upload larger files, please use a different client.

    - if @missing_file
      -# cannot show this as an error on the <input type="file"> since <input type="file"> apparently cannot display errors ¯\_(ツ)_/¯
      %p.alert.alert-error
        No file selected.

    %fieldset
      -# NOTE: <input type="file"> requires `authenticity_token: true` on the (simple_)form_for() to work
      = f.input :file,     as: :file,   input_html: { id: 'object_storage_upload_file' },     label: 'Select file'
      = f.input :filename, as: :string, input_html: { id: 'object_storage_upload_filename' }, label: 'File name'

    %div.buttons{class: modal? ? 'modal-footer' : ''}
      - if modal?
        %button.btn.btn-default{type:"button", data: { dismiss:"modal" }, aria: { label: "Cancel" }} Cancel
      - else
        = link_to "Cancel", plugin('object_storage').list_objects_path(@container_name, @object.path), class: 'btn btn-default'
      %button.btn.btn-primary{type: "submit", data: { disable_with: 'Please wait...'}} Save

=content_for :javascripts do
  :javascript
    $('#linkto_webconsole').on('click', Dashboard.hideModal);

    //when a file has been selected, put its name into the filename input as a default
    $('#object_storage_upload_file').on('change', function() {
      var file = this.files[0];
      if (file) {
        $('#object_storage_upload_filename').val(file.name);
      }
    });
